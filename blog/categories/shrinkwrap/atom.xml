<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: ShrinkWrap | Steve Hostettler]]></title>
  <link href="http://hostettler.github.io/blog/categories/shrinkwrap/atom.xml" rel="self"/>
  <link href="http://hostettler.github.io/"/>
  <updated>2015-01-18T09:44:52+01:00</updated>
  <id>http://hostettler.github.io/</id>
  <author>
    <name><![CDATA[Steve Hostettler]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Programmatically Build Web Archives Using ShrinkWrap]]></title>
    <link href="http://hostettler.github.io/blog/2012/04/05/programmatically-build-web-archives-using-shrinkwrap/"/>
    <updated>2012-04-05T09:09:00+02:00</updated>
    <id>http://hostettler.github.io/blog/2012/04/05/programmatically-build-web-archives-using-shrinkwrap</id>
    <content type="html"><![CDATA[<p>While doing integration tests on web applications, it is important to restrict the application to the strict minimum necessary for any given test. It helps to improve the startup time as well as to reduce unexpected interactions.
To that end, I use <a href="http://www.jboss.org/shrinkwrap">ShrinkWrap</a> from <a href="http://www.jboss.org/">JBoss</a> that is a very nice a simple API to build Java archives (e.g., JAR WAR, EAR). This post describes how to programmatically build a WAR file that can be deployed on an embedded server for integration
testing. For more details on how to use this web archive in JUnit fixtures please refer to this <a href="/blog/2012/04/09/embedded-jee-web-application-integration-testing-using-tomcat-7/">article</a>. The following snippet gets the ShrinkWrap package from the JBoss repository. As I only use it for test purposes, I restricted its use to the test scope.</p>

<p><strong>ShrinkWrap</strong> is available as a Maven dependency:
```xml Maven dependencies for the ShrinkWrap project
<repositories>
...</p>

<pre><code>&lt;repository&gt;
    &lt;id&gt;repository.jboss.org&lt;/id&gt;
    &lt;name&gt;JBoss Repository&lt;/name&gt;
    &lt;url&gt;http://repository.jboss.org/nexus/content/groups/public-jboss/&lt;/url&gt;
&lt;/repository&gt;
...
</code></pre>

<p></repositories>
...
<dependencies></p>

<pre><code>...
&lt;dependency&gt;
    &lt;groupId&gt;org.jboss.shrinkwrap&lt;/groupId&gt;
    &lt;artifactId&gt;shrinkwrap-api&lt;/artifactId&gt;
    &lt;version&gt;1.0.0-alpha-12&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.jboss.shrinkwrap&lt;/groupId&gt;
    &lt;artifactId&gt;shrinkwrap-impl&lt;/artifactId&gt;
    &lt;version&gt;1.0.0-alpha-12&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>

<p>...
<dependencies>
```</p>

<h2>Building the archive</h2>

<p>The first step is to crate a web archive a.k.a. a WAR file. As we want to produce a WAR file, we use the <code>WebArchive.class</code> parameter
to the <code>ShrinkWrap.create</code> method. It is also possible to produce JAR (<code>JavaArchive.class</code>) and EAR (<code>EnterpriseArchive.class</code>).
<code>java Creation of a Web Archive
WebArchive archive = ShrinkWrap.create(WebArchive.class, "test.war");
</code>
The next step to build a WAR is to provide the <code>web.xml</code> for you project. Again this can a be a simplified version of the web descriptor to improve startup time or limit dependencies. In the following example, the files are taken from a maven directory structure.</p>

<p>```java Add a web descriptor to the archive
private static final String WEBAPP_SRC = "src/main/webapp";</p>

<p>archive.setWebXML(new File(WEBAPP_SRC, "WEB-INF/web.xml"))
<code>
Now that we have a web descriptor, let's add some classes that are required to run the application. To not having to add each single class individually, it is possible to a complete package to the archive.
</code>java add a package to the runtime classes
archive.addPackage(java.lang.Package.getPackage("ch.demo.web"))
```</p>

<p>It is also possible to add individual classes:
<code>java add a class to the runtime classes
archive.addClasses(Student.class, Address.class);
</code></p>

<p>For JSF applications, we add add the <code>faces-config.xml</code>.
<code>java
archive.addAsWebInfResource(new File(WEBAPP_SRC, "WEB-INF/faces-config.xml"))
</code></p>

<p>And similarly, let's add the CDI descriptor into <code>WEB-INF</code>. As we do not need to create a specific <code>`beans.xml</code>,
we add an empty descriptor:
<code>java
archive.addAsWebInfResource(EmptyAsset.INSTANCE, "beans.xml")
</code></p>

<p>Let's finally add standard web resources such as <code>xhtml</code> files or static files:
<code>java
archive.addAsWebResource(new File(WEBAPP_SRC, "login.xhtml"));
</code></p>

<p>As ShrinkWrap uses <a href="http://en.wikipedia.org/wiki/Method_chaining">Method Chaining</a>, it is possible to chain <code>add</code> class to fill the archive.
```java Build a simple web application    <br/>
archive.setWebXML(new File(WEBAPP_SRC, "WEB-INF/web.xml"))</p>

<pre><code>.addAsWebInfResource(EmptyAsset.INSTANCE, "beans.xml")
.addAsWebInfResource(new File(WEBAPP_SRC, "WEB-INF/faces-config.xml"))
.addPackage(java.lang.Package.getPackage("ch.demo.web"))
.addAsWebResource(new File(WEBAPP_SRC, "login.xhtml"))
.addAsWebResource(new File(WEBAPP_SRC, "index.jsp"))
.addAsWebResource(new File(WEBAPP_SRC, "xhtml/listStudents.xhtml"), "xhtml/listStudents.xhtml");
</code></pre>

<p>```</p>

<p>Please note that when using maven to execute the tests, most of the required libraries are already on the classpath. Therefore, we often do not need to add any library or jars to the web archive.</p>

<h2>Using the archive</h2>

<p>After having built the package, we need to export it either as a war or as an exploded directory.
The following snippet produces a WAR file named after the archive. The second parameter states whether
a existing archive can be overwritten.
<code>java Produce the actual war
new ZipExporterImpl(archive).exportTo(new File(archive.getName()), true);
</code>
Alternatively it is possible to produce an exploded archive:
<code>java Produce an exploded archive
new ExplodedExporterImpl(archive).exportExploded(new File(archive.getName()));
</code></p>

<h2>Conclusion</h2>

<p>We have seen how to use ShrinkWrap to programmatically build Web archives. This is especially useful to test smaller version of your web application during integration testing. It helps to test webapps with mock services and to improve the startup time. The examples used in this blog are to be found in the <a href="http://code.google.com/p/jee6-demo/">JEE-6-Demo</a> project on <a href="http://code.google.com">Google code hosting</a>.</p>
]]></content>
  </entry>
  
</feed>
